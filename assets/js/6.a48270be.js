(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{392:function(t,s,a){t.exports=a.p+"assets/img/性能工具.c4e5f9a0.png"},393:function(t,s,a){t.exports=a.p+"assets/img/性能工具-查看内存波动.834a12a2.png"},394:function(t,s,a){t.exports=a.p+"assets/img/内存工具.0833c933.png"},395:function(t,s,a){t.exports=a.p+"assets/img/堆快照-比较两个快照之间的差异.cf034435.png"},396:function(t,s,a){t.exports=a.p+"assets/img/堆快照.c2f67290.png"},397:function(t,s,a){t.exports=a.p+"assets/img/分配时间轴-摘要.243ae39e.png"},398:function(t,s,a){t.exports=a.p+"assets/img/分配时间轴-分配.43b24d0f.png"},399:function(t,s,a){t.exports=a.p+"assets/img/抽样分析.d1d7542d.png"},400:function(t,s,a){t.exports=a.p+"assets/img/任务管理器.6182ea8b.png"},401:function(t,s,a){t.exports=a.p+"assets/img/性能监视器.af60daa9.png"},498:function(t,s,a){"use strict";a.r(s);var n=a(2),r=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"chrome性能、内存工具使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#chrome性能、内存工具使用"}},[t._v("#")]),t._v(" chrome性能、内存工具使用")]),t._v(" "),s("p",[t._v("内存不足会造成不断 GC，而 GC 时是会阻塞主线程的，所以会影响到页面性能，造成卡顿，甚至崩溃。")]),t._v(" "),s("p",[t._v("这篇文章将教学如何使用chrome自带的性能工具来定位内存问题。")]),t._v(" "),s("p",[s("strong",[t._v("示例代码")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 按钮1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" arr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nstartBtn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"click"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" a "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Array")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fill")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" b "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Array")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fill")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    arr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 按钮2")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" t "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("replaceThing")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" o "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" t\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("unused")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("o"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hi"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("        \n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n \n  t "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("longStr")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Array")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fill")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("someMethod")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("我们在函数内申请了两个数组内存，但其中有个数组却被外部持有，那么，即使每次函数执行完，这部分被外部持有的数组内存也依旧回收不了，所以每次只能回收一部分内存")]),t._v(" "),s("p",[t._v("这样一来，当函数调用次数增多时，没法回收的内存就越多，内存泄漏的也就越多，内存使用量也会一直在增长。")]),t._v(" "),s("h2",{attrs:{id:"性能工具-判断是否产生内存泄漏"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#性能工具-判断是否产生内存泄漏"}},[t._v("#")]),t._v(" 性能工具---判断是否产生内存泄漏")]),t._v(" "),s("p",[t._v("查看一段时间内的性能变化")]),t._v(" "),s("p",[s("img",{attrs:{src:a(392),alt:""}})]),t._v(" "),s("p",[t._v("在录制过程中，我们多次点击按钮，触发click事件，最后结束录制。生成如下图：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(393),alt:""}})]),t._v(" "),s("p",[t._v("梯状上升的就是发生内存泄漏了，每次函数调用，总有一部分数据被外部持有导致无法回收，而后面平滑状的则是每次使用完都可以正常被回收")]),t._v(" "),s("h2",{attrs:{id:"内存工具-查找内存泄漏的位置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#内存工具-查找内存泄漏的位置"}},[t._v("#")]),t._v(" 内存工具---查找内存泄漏的位置")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("语义解释")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("key")]),t._v(" "),s("th",[t._v("语义")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("prototype")]),t._v(" "),s("td",[t._v("函数原型")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("proto")])]),t._v(" "),s("td",[t._v("对象原型")])]),t._v(" "),s("tr",[s("td",[t._v("context")]),t._v(" "),s("td",[t._v("上下文环境（同级）")])]),t._v(" "),s("tr",[s("td",[t._v("elements")]),t._v(" "),s("td",[t._v("元素")])])])])]),t._v(" "),s("p",[t._v("分析内存泄漏的原因，还是需要借助开发者工具的 内存（Memory） 功能，这个功能可以抓取内存快照，也可以抓取一段时间内，内存分配的情况，还可以抓取一段时间内触发内存分配的各函数情况")]),t._v(" "),s("p",[t._v("利用这些工具，我们可以分析出，某个时刻是由于哪个函数操作导致了内存分配，分析出大量重复且没有被回收的对象是什么")]),t._v(" "),s("p",[t._v("这样一来，有嫌疑的函数也知道了，有嫌疑的对象也知道了，再去代码中分析下，这个函数里的这个对象到底是不是就是内存泄漏的元凶。")]),t._v(" "),s("p",[s("img",{attrs:{src:a(394),alt:""}})]),t._v(" "),s("h3",{attrs:{id:"内存快照"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#内存快照"}},[t._v("#")]),t._v(" 内存快照")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("释义")]),t._v(" "),s("p",[t._v("查看此时的内存信息。")])]),t._v(" "),s("p",[t._v("可以抓取两份快照，两份快照中间进行内存泄漏操作，最后再比对两份快照的区别，查看增加的对象是什么，回收的对象又是哪些，如下图：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(395),alt:""}})]),t._v(" "),s("p",[t._v("也可以单独查看某个时刻快照，从内存占用比例来查看占据大量内存的是什么对象，如下图：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(396),alt:""}})]),t._v(" "),s("p",[t._v("从上面这些方式入手，都可以查看到当前占用大量内存的对象是什么，一般来说，这个就是嫌疑犯了")]),t._v(" "),s("p",[t._v("当然，也并不一定，当有嫌疑对象时，可以利用多次内存快照间比对，中间手动强制 GC 下，看下该回收的对象有没有被回收，这是一种思路")]),t._v(" "),s("h3",{attrs:{id:"分配时间轴"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#分配时间轴"}},[t._v("#")]),t._v(" 分配时间轴")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("释义")]),t._v(" "),s("p",[t._v("抓取一段时间内，内存分配情况。")])]),t._v(" "),s("p",[s("img",{attrs:{src:a(397),alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:a(398),alt:""}})]),t._v(" "),s("p",[t._v("这个方式，可以有选择性的查看各个内存分配时刻是由哪个函数发起，且内存存储的是什么对象")]),t._v(" "),s("p",[t._v("当然，内存分配是正常行为，这里查看到的还需要借助其他数据来判断某个对象是否是嫌疑对象，比如内存占用比例，或结合内存快照等等")]),t._v(" "),s("h3",{attrs:{id:"抽样分析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#抽样分析"}},[t._v("#")]),t._v(" 抽样分析")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("释义")]),t._v(" "),s("p",[t._v("抓取一段时间内，哪些函数申请了内存。")])]),t._v(" "),s("p",[s("img",{attrs:{src:a(399),alt:""}})]),t._v(" "),s("p",[t._v("这个能看到的内容很少，比较简单，目的也很明确，就是一段时间内，都有哪些操作在申请内存，且用了多少")]),t._v(" "),s("p",[t._v("总之，这些工具并没有办法直接给你答复，告诉你 xxx 就是内存泄漏的元凶，如果浏览器层面就能确定了，那它干嘛不回收它，干嘛还会造成内存泄漏")]),t._v(" "),s("p",[t._v("所以，这些工具，只能给你各种内存使用信息，你需要自己借助这些信息，根据自己代码的逻辑，去分析，哪些嫌疑对象才是内存泄漏的元凶")]),t._v(" "),s("h2",{attrs:{id:"chrome任务管理器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#chrome任务管理器"}},[t._v("#")]),t._v(" chrome任务管理器")]),t._v(" "),s("p",[t._v("打开方式: 通过"),s("code",[t._v("shift + esc")]),t._v("快捷键打开。")]),t._v(" "),s("p",[t._v("可以查看每个标签页所占用的内存情况。")]),t._v(" "),s("p",[s("img",{attrs:{src:a(400),alt:""}})]),t._v(" "),s("h2",{attrs:{id:"性能监视器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#性能监视器"}},[t._v("#")]),t._v(" 性能监视器")]),t._v(" "),s("p",[t._v("打开性能监视器，这是一个可以实时监控 cpu，内存等使用情况的工具，会比上面只能抓取一段时间内工具更直观一点：")]),t._v(" "),s("p",[s("img",{attrs:{src:a(401),alt:""}})])])}),[],!1,null,null,null);s.default=r.exports}}]);