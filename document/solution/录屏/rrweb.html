<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>使用指南 | wk-ui</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="王先生的小屋">
    
    <link rel="preload" href="/assets/css/0.styles.81c6a691.css" as="style"><link rel="preload" href="/assets/js/app.2be4d4d0.js" as="script"><link rel="preload" href="/assets/js/3.ea86773f.js" as="script"><link rel="preload" href="/assets/js/46.c3c4ea4d.js" as="script"><link rel="prefetch" href="/assets/js/10.3a444ea4.js"><link rel="prefetch" href="/assets/js/11.5b108d04.js"><link rel="prefetch" href="/assets/js/12.b2a39fbe.js"><link rel="prefetch" href="/assets/js/13.28c80f56.js"><link rel="prefetch" href="/assets/js/14.50ce5c38.js"><link rel="prefetch" href="/assets/js/15.18415231.js"><link rel="prefetch" href="/assets/js/16.0d72e31a.js"><link rel="prefetch" href="/assets/js/17.c9522733.js"><link rel="prefetch" href="/assets/js/18.c98194e6.js"><link rel="prefetch" href="/assets/js/19.4b15bab5.js"><link rel="prefetch" href="/assets/js/2.3144a011.js"><link rel="prefetch" href="/assets/js/20.82f9d76a.js"><link rel="prefetch" href="/assets/js/21.d45bd573.js"><link rel="prefetch" href="/assets/js/22.2ecc2590.js"><link rel="prefetch" href="/assets/js/23.62a6a1f5.js"><link rel="prefetch" href="/assets/js/24.7f2c7652.js"><link rel="prefetch" href="/assets/js/25.10073d5e.js"><link rel="prefetch" href="/assets/js/26.b23d605f.js"><link rel="prefetch" href="/assets/js/27.f024d33f.js"><link rel="prefetch" href="/assets/js/28.1fdded9d.js"><link rel="prefetch" href="/assets/js/29.39a61266.js"><link rel="prefetch" href="/assets/js/30.c470de9a.js"><link rel="prefetch" href="/assets/js/31.01f77d1f.js"><link rel="prefetch" href="/assets/js/32.6386b577.js"><link rel="prefetch" href="/assets/js/33.bbe893ef.js"><link rel="prefetch" href="/assets/js/34.5a9e5b9c.js"><link rel="prefetch" href="/assets/js/35.dd264f19.js"><link rel="prefetch" href="/assets/js/36.09b96a01.js"><link rel="prefetch" href="/assets/js/37.bef3af83.js"><link rel="prefetch" href="/assets/js/38.077c111c.js"><link rel="prefetch" href="/assets/js/39.c4e728a8.js"><link rel="prefetch" href="/assets/js/4.6b8f2df9.js"><link rel="prefetch" href="/assets/js/40.531c78f4.js"><link rel="prefetch" href="/assets/js/41.17556d08.js"><link rel="prefetch" href="/assets/js/42.e7c8a524.js"><link rel="prefetch" href="/assets/js/43.3ccdcffb.js"><link rel="prefetch" href="/assets/js/44.0b3d4d8d.js"><link rel="prefetch" href="/assets/js/45.00b13525.js"><link rel="prefetch" href="/assets/js/47.247a56c8.js"><link rel="prefetch" href="/assets/js/48.5cd5bb77.js"><link rel="prefetch" href="/assets/js/49.f1a8daf9.js"><link rel="prefetch" href="/assets/js/5.21c8da66.js"><link rel="prefetch" href="/assets/js/50.4dbaaf1a.js"><link rel="prefetch" href="/assets/js/51.c479ee66.js"><link rel="prefetch" href="/assets/js/52.024587ca.js"><link rel="prefetch" href="/assets/js/53.d4f9d2a8.js"><link rel="prefetch" href="/assets/js/54.556cf9bd.js"><link rel="prefetch" href="/assets/js/55.c3538cb3.js"><link rel="prefetch" href="/assets/js/56.a8ab714d.js"><link rel="prefetch" href="/assets/js/57.1694d9b3.js"><link rel="prefetch" href="/assets/js/58.e2b1ab9e.js"><link rel="prefetch" href="/assets/js/59.8f63f478.js"><link rel="prefetch" href="/assets/js/6.048e1034.js"><link rel="prefetch" href="/assets/js/60.240e7659.js"><link rel="prefetch" href="/assets/js/61.65912b09.js"><link rel="prefetch" href="/assets/js/62.231765ab.js"><link rel="prefetch" href="/assets/js/63.884d2238.js"><link rel="prefetch" href="/assets/js/64.e2ed9e7f.js"><link rel="prefetch" href="/assets/js/65.c9f0e5f1.js"><link rel="prefetch" href="/assets/js/66.f717058e.js"><link rel="prefetch" href="/assets/js/7.e478d96a.js"><link rel="prefetch" href="/assets/js/8.5d3c850a.js"><link rel="prefetch" href="/assets/js/9.3c6e7de5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.81c6a691.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">wk-ui</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/document/form/dialog.html" class="nav-link">
  组件文档
</a></div><div class="nav-item"><a href="/document/directive/permission.html" class="nav-link">
  指令
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/document/tools/图片压缩/图片压缩.html" class="nav-link">
  图片压缩
</a></li><li class="dropdown-item"><h4>
          git
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/document/tools/git/git-ssh.html" class="nav-link">
  git解决方案
</a></li></ul></li><li class="dropdown-item"><h4>
          npm
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/document/tools/npm/nrm.html" class="nav-link">
  nrm换源
</a></li><li class="dropdown-subitem"><a href="/document/tools/npm/changeOrigin.html" class="nav-link">
  npm手动换源
</a></li><li class="dropdown-subitem"><a href="/document/tools/npm/pnpm.html" class="nav-link">
  pnpm
</a></li></ul></li><li class="dropdown-item"><h4>
          eslint
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/document/tools/eslint/提交钩子.html" class="nav-link">
  提交钩子
</a></li><li class="dropdown-subitem"><a href="/document/tools/eslint/常见报错.html" class="nav-link">
  常见报错
</a></li></ul></li><li class="dropdown-item"><h4>
          自由
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/document/tools/free/梯子.html" class="nav-link">
  梯子
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="阅读" class="dropdown-title"><span class="title">阅读</span> <span class="arrow down"></span></button> <button type="button" aria-label="阅读" class="mobile-dropdown-title"><span class="title">阅读</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/document/read/正面教育.html" class="nav-link">
  正面教育
</a></li><li class="dropdown-item"><!----> <a href="/document/read/财富安全法则.html" class="nav-link">
  财富安全法则
</a></li><li class="dropdown-item"><!----> <a href="/document/read/算法学习.html" class="nav-link">
  hello 算法
</a></li></ul></div></div><div class="nav-item"><a href="/document/skill/skill.html" class="nav-link">
  开发技巧
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具代码库" class="dropdown-title"><span class="title">工具代码库</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具代码库" class="mobile-dropdown-title"><span class="title">工具代码库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/document/utils/vue.html" class="nav-link">
  vue
</a></li><li class="dropdown-item"><!----> <a href="/document/utils/媒体.html" class="nav-link">
  媒体
</a></li><li class="dropdown-item"><!----> <a href="/document/utils/数据类型操作.html" class="nav-link">
  数据类型操作
</a></li><li class="dropdown-item"><!----> <a href="/document/utils/时间操作.html" class="nav-link">
  时间操作
</a></li><li class="dropdown-item"><!----> <a href="/document/utils/空间、坐标、地理.html" class="nav-link">
  空间、坐标、地理
</a></li><li class="dropdown-item"><!----> <a href="/document/utils/设备、环境、功能支持.html" class="nav-link">
  设备、环境、功能支持
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="解决方案" class="dropdown-title"><span class="title">解决方案</span> <span class="arrow down"></span></button> <button type="button" aria-label="解决方案" class="mobile-dropdown-title"><span class="title">解决方案</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/document/solution/内存泄漏/内存泄漏.html" class="nav-link">
  内存泄漏
</a></li><li class="dropdown-item"><!----> <a href="/document/solution/微前端/微前端.html" class="nav-link">
  微前端
</a></li><li class="dropdown-item"><!----> <a href="/document/solution/夸页面通信/夸页面通信.html" class="nav-link">
  夸页面通信
</a></li><li class="dropdown-item"><!----> <a href="/document/solution/换肤/换肤.html" class="nav-link">
  换肤
</a></li><li class="dropdown-item"><!----> <a href="/document/solution/大屏模块化/介绍.html" class="nav-link">
  大屏设计器
</a></li><li class="dropdown-item"><!----> <a href="/document/solution/高分辨率图片加载/高分辨率图片加载.html" class="nav-link">
  高分辨率图片加载
</a></li><li class="dropdown-item"><!----> <a href="/document/solution/录屏/录屏.html" class="nav-link">
  录屏
</a></li><li class="dropdown-item"><!----> <a href="/document/solution/中文字体子集化方案/中文字体子集化方案.html" class="nav-link">
  中文字体子集化方案
</a></li><li class="dropdown-item"><!----> <a href="/document/solution/常见附件预览/常见附件预览.html" class="nav-link">
  常见附件预览：图片、视频、音频、文本、pdf、office
</a></li><li class="dropdown-item"><!----> <a href="/document/solution/element-ui图标乱码解决/element-ui图标乱码解决.html" class="nav-link">
  element-ui图标乱码解决
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="游乐场" class="dropdown-title"><span class="title">游乐场</span> <span class="arrow down"></span></button> <button type="button" aria-label="游乐场" class="mobile-dropdown-title"><span class="title">游乐场</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/document/play/autoSendEmail/autoSendEmail.html" class="nav-link">
  自动发送邮件
</a></li></ul></div></div><div class="nav-item"><a href="/document/openai/openai.html" class="nav-link">
  人工智能
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="生活" class="dropdown-title"><span class="title">生活</span> <span class="arrow down"></span></button> <button type="button" aria-label="生活" class="mobile-dropdown-title"><span class="title">生活</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/document/life/健康的作息时间.html" class="nav-link">
  健康的作息时间
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/document/form/dialog.html" class="nav-link">
  组件文档
</a></div><div class="nav-item"><a href="/document/directive/permission.html" class="nav-link">
  指令
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/document/tools/图片压缩/图片压缩.html" class="nav-link">
  图片压缩
</a></li><li class="dropdown-item"><h4>
          git
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/document/tools/git/git-ssh.html" class="nav-link">
  git解决方案
</a></li></ul></li><li class="dropdown-item"><h4>
          npm
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/document/tools/npm/nrm.html" class="nav-link">
  nrm换源
</a></li><li class="dropdown-subitem"><a href="/document/tools/npm/changeOrigin.html" class="nav-link">
  npm手动换源
</a></li><li class="dropdown-subitem"><a href="/document/tools/npm/pnpm.html" class="nav-link">
  pnpm
</a></li></ul></li><li class="dropdown-item"><h4>
          eslint
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/document/tools/eslint/提交钩子.html" class="nav-link">
  提交钩子
</a></li><li class="dropdown-subitem"><a href="/document/tools/eslint/常见报错.html" class="nav-link">
  常见报错
</a></li></ul></li><li class="dropdown-item"><h4>
          自由
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/document/tools/free/梯子.html" class="nav-link">
  梯子
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="阅读" class="dropdown-title"><span class="title">阅读</span> <span class="arrow down"></span></button> <button type="button" aria-label="阅读" class="mobile-dropdown-title"><span class="title">阅读</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/document/read/正面教育.html" class="nav-link">
  正面教育
</a></li><li class="dropdown-item"><!----> <a href="/document/read/财富安全法则.html" class="nav-link">
  财富安全法则
</a></li><li class="dropdown-item"><!----> <a href="/document/read/算法学习.html" class="nav-link">
  hello 算法
</a></li></ul></div></div><div class="nav-item"><a href="/document/skill/skill.html" class="nav-link">
  开发技巧
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具代码库" class="dropdown-title"><span class="title">工具代码库</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具代码库" class="mobile-dropdown-title"><span class="title">工具代码库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/document/utils/vue.html" class="nav-link">
  vue
</a></li><li class="dropdown-item"><!----> <a href="/document/utils/媒体.html" class="nav-link">
  媒体
</a></li><li class="dropdown-item"><!----> <a href="/document/utils/数据类型操作.html" class="nav-link">
  数据类型操作
</a></li><li class="dropdown-item"><!----> <a href="/document/utils/时间操作.html" class="nav-link">
  时间操作
</a></li><li class="dropdown-item"><!----> <a href="/document/utils/空间、坐标、地理.html" class="nav-link">
  空间、坐标、地理
</a></li><li class="dropdown-item"><!----> <a href="/document/utils/设备、环境、功能支持.html" class="nav-link">
  设备、环境、功能支持
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="解决方案" class="dropdown-title"><span class="title">解决方案</span> <span class="arrow down"></span></button> <button type="button" aria-label="解决方案" class="mobile-dropdown-title"><span class="title">解决方案</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/document/solution/内存泄漏/内存泄漏.html" class="nav-link">
  内存泄漏
</a></li><li class="dropdown-item"><!----> <a href="/document/solution/微前端/微前端.html" class="nav-link">
  微前端
</a></li><li class="dropdown-item"><!----> <a href="/document/solution/夸页面通信/夸页面通信.html" class="nav-link">
  夸页面通信
</a></li><li class="dropdown-item"><!----> <a href="/document/solution/换肤/换肤.html" class="nav-link">
  换肤
</a></li><li class="dropdown-item"><!----> <a href="/document/solution/大屏模块化/介绍.html" class="nav-link">
  大屏设计器
</a></li><li class="dropdown-item"><!----> <a href="/document/solution/高分辨率图片加载/高分辨率图片加载.html" class="nav-link">
  高分辨率图片加载
</a></li><li class="dropdown-item"><!----> <a href="/document/solution/录屏/录屏.html" class="nav-link">
  录屏
</a></li><li class="dropdown-item"><!----> <a href="/document/solution/中文字体子集化方案/中文字体子集化方案.html" class="nav-link">
  中文字体子集化方案
</a></li><li class="dropdown-item"><!----> <a href="/document/solution/常见附件预览/常见附件预览.html" class="nav-link">
  常见附件预览：图片、视频、音频、文本、pdf、office
</a></li><li class="dropdown-item"><!----> <a href="/document/solution/element-ui图标乱码解决/element-ui图标乱码解决.html" class="nav-link">
  element-ui图标乱码解决
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="游乐场" class="dropdown-title"><span class="title">游乐场</span> <span class="arrow down"></span></button> <button type="button" aria-label="游乐场" class="mobile-dropdown-title"><span class="title">游乐场</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/document/play/autoSendEmail/autoSendEmail.html" class="nav-link">
  自动发送邮件
</a></li></ul></div></div><div class="nav-item"><a href="/document/openai/openai.html" class="nav-link">
  人工智能
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="生活" class="dropdown-title"><span class="title">生活</span> <span class="arrow down"></span></button> <button type="button" aria-label="生活" class="mobile-dropdown-title"><span class="title">生活</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/document/life/健康的作息时间.html" class="nav-link">
  健康的作息时间
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/document/solution/录屏/录屏.html" class="sidebar-link">录屏</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/document/solution/录屏/录屏.html#使用-webrtc" class="sidebar-link">使用 WebRTC</a></li><li class="sidebar-sub-header"><a href="/document/solution/录屏/录屏.html#使用-rrweb" class="sidebar-link">使用 rrweb</a></li><li class="sidebar-sub-header"><a href="/document/solution/录屏/录屏.html#最终实践方案" class="sidebar-link">最终实践方案</a></li><li class="sidebar-sub-header"><a href="/document/solution/录屏/录屏.html#rrweb-原理详解" class="sidebar-link">rrweb 原理详解</a></li><li class="sidebar-sub-header"><a href="/document/solution/录屏/录屏.html#沙箱回放还是录制视频存储" class="sidebar-link">沙箱回放还是录制视频存储？</a></li><li class="sidebar-sub-header"><a href="/document/solution/录屏/录屏.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/document/solution/录屏/rrweb.html" class="active sidebar-link">rrweb</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/document/solution/录屏/rrweb.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/document/solution/录屏/rrweb.html#快速开始" class="sidebar-link">快速开始</a></li><li class="sidebar-sub-header"><a href="/document/solution/录屏/rrweb.html#repl-工具" class="sidebar-link">REPL 工具</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="使用指南"><a href="#使用指南" class="header-anchor">#</a> 使用指南</h1> <blockquote><p>除通用的使用指南外，你可能还想通过<a href="/document/solution/录屏/docs/recipes/index.zh_CN.html">场景示例</a>了解特定场景下的使用方式，或是通过<a href="./docs">设计文档</a>深入 rrweb 的技术细节。</p></blockquote> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <h3 id="直接通过-script-引入"><a href="#直接通过-script-引入" class="header-anchor">#</a> 直接通过 <code>&lt;script&gt;</code> 引入</h3> <p>推荐通过 jsdelivr 的 CDN 安装：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span>
  <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.jsdelivr.net/npm/rrweb@latest/dist/rrweb.min.css<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.jsdelivr.net/npm/rrweb@latest/dist/rrweb.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>也可以在 URL 中指定具体的版本号，例如：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.jsdelivr.net/npm/rrweb@0.7.0/dist/rrweb.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="仅引入录制部分"><a href="#仅引入录制部分" class="header-anchor">#</a> 仅引入录制部分</h4> <p>rrweb 代码分为录制和回放两部分，大多数时候用户在被录制的应用中只需要引入录制部分代码，同样可以通过 CDN 安装：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.jsdelivr.net/npm/rrweb@latest/dist/record/rrweb-record.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="其它按需引入方式"><a href="#其它按需引入方式" class="header-anchor">#</a> 其它按需引入方式</h4> <p>除了仅包含录制代码的 <code>record/rrweb-record-min.js</code> 之外，rrweb 还提供了其它多种可选的打包文件。所有包含 <code>.min</code> 的文件为同名文件的压缩版。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 包含录制、回放、压缩数据、解压缩数据</span>
rrweb-all.js
rrweb-all.min.js
<span class="token comment"># 包含录制、回放</span>
rrweb.js
rrweb.min.js
<span class="token comment"># 回放所需的样式文件</span>
rrweb.min.css
<span class="token comment"># 录制</span>
record/rrweb-record.js
record/rrweb-record.min.js
<span class="token comment"># 压缩数据</span>
record/rrweb-record-pack.js
record/rrweb-record-pack.min.js
<span class="token comment"># 回放</span>
replay/rrweb-replay.js
replay/rrweb-replay.min.js
<span class="token comment"># 解压缩数据</span>
replay/rrweb-replay-unpack.js
replay/rrweb-replay-unpack.min.js
</code></pre></div><h3 id="通过-npm-引入"><a href="#通过-npm-引入" class="header-anchor">#</a> 通过 npm 引入</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">--save</span> rrweb
</code></pre></div><p>rrweb 同时提供 commonJS 和 ES modules 两种格式的打包文件，易于和常见的打包工具配合使用。</p> <h3 id="兼容性"><a href="#兼容性" class="header-anchor">#</a> 兼容性</h3> <p>由于使用 <code>MutationObserver</code> API，rrweb 不支持 IE11 以下的浏览器。可以从<a href="https://caniuse.com/#feat=mutationobserver" target="_blank" rel="noopener noreferrer">这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>找到兼容的浏览器列表。</p> <h2 id="快速开始"><a href="#快速开始" class="header-anchor">#</a> 快速开始</h2> <h3 id="录制"><a href="#录制" class="header-anchor">#</a> 录制</h3> <p>如果通过 <code>&lt;script&gt;</code> 的方式仅引入录制部分，那么可以访问到全局变量 <code>rrwebRecord</code>，它和全量引入时的 <code>rrweb.record</code> 使用方式完全一致，以下示例代码将使用后者。</p> <div class="language-js extra-class"><pre class="language-js"><code>rrweb<span class="token punctuation">.</span><span class="token function">record</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">emit</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 用任意方式存储 event</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>rrweb 在录制时会不断将各类 event 传递给配置的 emit 方法，你可以使用任何方式存储这些 event 以便之后回放。</p> <p>调用 <code>record</code> 方法将返回一个函数，调用该函数可以终止录制：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> stopFn <span class="token operator">=</span> rrweb<span class="token punctuation">.</span><span class="token function">record</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">emit</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>events<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 当事件数量大于 100 时停止录制</span>
      <span class="token function">stopFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>一个更接近实际真实使用场景的示例如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> events <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
rrweb<span class="token punctuation">.</span><span class="token function">record</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">emit</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 将 event 存入 events 数组中</span>
    events<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// save 函数用于将 events 发送至后端存入，并重置 events 数组</span>
<span class="token keyword">function</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> events <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  events <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://YOUR_BACKEND_API'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    body<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 每 10 秒调用一次 save 方法，避免请求过多</span>
<span class="token function">setInterval</span><span class="token punctuation">(</span>save<span class="token punctuation">,</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="配置参数"><a href="#配置参数" class="header-anchor">#</a> 配置参数</h4> <p><code>rrweb.record(config)</code> 的 config 部分接受以下参数</p> <table><thead><tr><th>key</th> <th>默认值</th> <th>功能</th></tr></thead> <tbody><tr><td>emit</td> <td>必填</td> <td>获取当前录制的数据</td></tr> <tr><td>checkoutEveryNth</td> <td>-</td> <td>每 N 次事件重新制作一次全量快照<br>详见<a href="#%E9%87%8D%E6%96%B0%E5%88%B6%E4%BD%9C%E5%BF%AB%E7%85%A7">“重新制作快照”</a>章节</td></tr> <tr><td>checkoutEveryNms</td> <td>-</td> <td>每 N 毫秒重新制作一次全量快照<br>详见<a href="#%E9%87%8D%E6%96%B0%E5%88%B6%E4%BD%9C%E5%BF%AB%E7%85%A7">“重新制作快照”</a>章节</td></tr> <tr><td>blockClass</td> <td>'rr-block'</td> <td>字符串或正则表达式，可用于自定义屏蔽元素的类名，详见<a href="#%E9%9A%90%E7%A7%81">“隐私”</a>章节</td></tr> <tr><td>blockSelector</td> <td>null</td> <td>所有 element.matches(blockSelector)为 true 的元素都不会被录制，回放时取而代之的是一个同等宽高的占位元素</td></tr> <tr><td>ignoreClass</td> <td>'rr-ignore'</td> <td>字符串或正则表达式，可用于自定义忽略元素的类名，详见<a href="#%E9%9A%90%E7%A7%81">“隐私”</a>章节</td></tr> <tr><td>ignoreCSSAttributes</td> <td>null</td> <td>应该被忽略的 CSS 属性数组</td></tr> <tr><td>maskTextClass</td> <td>'rr-mask'</td> <td>字符串或正则表达式，可用于自定义忽略元素 text 内容的类名，详见<a href="#%E9%9A%90%E7%A7%81">“隐私”</a>章节</td></tr> <tr><td>maskTextSelector</td> <td>null</td> <td>所有 element.matches(maskTextSelector)为 true 的元素及其子元素的 text 内容将会被屏蔽</td></tr> <tr><td>maskAllInputs</td> <td>false</td> <td>将所有输入内容记录为 *</td></tr> <tr><td>maskInputOptions</td> <td>{ password: true }</td> <td>选择将特定类型的输入框内容记录为 *<br>类型详见<a href="https://github.com/rrweb-io/rrweb/blob/588164aa12f1d94576f89ae0210b98f6e971c895/packages/rrweb-snapshot/src/types.ts#L77-L95" target="_blank" rel="noopener noreferrer">列表<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td></tr> <tr><td>maskInputFn</td> <td>-</td> <td>自定义特定类型的输入框内容记录逻辑</td></tr> <tr><td>maskTextFn</td> <td>-</td> <td>自定义文字内容的记录逻辑</td></tr> <tr><td>slimDOMOptions</td> <td>{}</td> <td>去除 DOM 中不必要的部分 <br>类型详见<a href="https://github.com/rrweb-io/rrweb/blob/588164aa12f1d94576f89ae0210b98f6e971c895/packages/rrweb-snapshot/src/types.ts#L97-L108" target="_blank" rel="noopener noreferrer">列表<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td></tr> <tr><td>inlineStylesheet</td> <td>true</td> <td>是否将样式表内联</td></tr> <tr><td>hooks</td> <td>{}</td> <td>各类事件的回调<br>类型详见<a href="https://github.com/rrweb-io/rrweb/blob/9488deb6d54a5f04350c063d942da5e96ab74075/src/types.ts#L207" target="_blank" rel="noopener noreferrer">列表<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td></tr> <tr><td>packFn</td> <td>-</td> <td>数据压缩函数，详见<a href="/document/solution/录屏/docs/recipes/optimize-storage.zh_CN.html">优化存储策略</a></td></tr> <tr><td>sampling</td> <td>-</td> <td>数据抽样策略，详见<a href="/document/solution/录屏/docs/recipes/optimize-storage.zh_CN.html">优化存储策略</a></td></tr> <tr><td>recordCanvas</td> <td>false</td> <td>是否记录 canvas 内容, 可用选项：false, true</td></tr> <tr><td>inlineImages</td> <td>false</td> <td>是否将图片内容记内联录制</td></tr> <tr><td>collectFonts</td> <td>false</td> <td>是否记录页面中的字体文件</td></tr> <tr><td>userTriggeredOnInput</td> <td>false</td> <td><a href="https://github.com/rrweb-io/rrweb/pull/495" target="_blank" rel="noopener noreferrer">什么是 <code>userTriggered</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td></tr> <tr><td>plugins</td> <td>[]</td> <td>加载插件以获得额外的录制功能. <a href="/document/solution/录屏/docs/recipes/plugin.zh_CN.html">什么是插件？</a></td></tr></tbody></table> <h4 id="隐私"><a href="#隐私" class="header-anchor">#</a> 隐私</h4> <p>页面中可能存在一些隐私相关的内容不希望被录制，rrweb 为此做了以下支持：</p> <ul><li>在 HTML 元素中添加类名 <code>.rr-block</code> 将会避免该元素及其子元素被录制，回放时取而代之的是一个同等宽高的占位元素。</li> <li>在 HTML 元素中添加类名 <code>.rr-ignore</code> 将会避免录制该元素的输入事件。</li> <li>所有带有<code>.rr-mask</code>类名的元素及其子元素的 text 内容将会被屏蔽。</li> <li><code>input[type=&quot;password&quot;]</code> 类型的密码输入框默认不会录制输入事件。</li> <li>配置中还有更为丰富的隐私保护选项。</li></ul> <h4 id="重新制作快照"><a href="#重新制作快照" class="header-anchor">#</a> 重新制作快照</h4> <p>默认情况下，要重放内容需要所有的 event，如果你不想存储所有的 event，可以使用<code>checkout</code>配置。</p> <p><strong>多数时候你不必这样配置</strong>。但比如在页面错误发生时，你只想捕获最近的几次 event ，这里有一个例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 使用二维数组来存放多个 event 数组</span>
<span class="token keyword">const</span> eventsMatrix <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
rrweb<span class="token punctuation">.</span><span class="token function">record</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">emit</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> isCheckout</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// isCheckout 是一个标识，告诉你重新制作了快照</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isCheckout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      eventsMatrix<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> lastEvents <span class="token operator">=</span> eventsMatrix<span class="token punctuation">[</span>eventsMatrix<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    lastEvents<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">checkoutEveryNth</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token comment">// 每 200 个 event 重新制作快照</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 向后端传送最新的两个 event 数组</span>
window<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> len <span class="token operator">=</span> eventsMatrix<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token keyword">const</span> events <span class="token operator">=</span> eventsMatrix<span class="token punctuation">[</span>len <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>eventsMatrix<span class="token punctuation">[</span>len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> events <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://YOUR_BACKEND_API'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    body<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>由于 rrweb 使用了增量快照机制，我们不能指定数量来捕获最近的几次 event。上面这个例子，你可以拿到最新的 200-400 个 event 来发送给你的后端。</p> <p>类似的，你可以通过配置 <code>checkoutEveryNms</code> 来捕获最近指定时间的 event :</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 使用二维数组来存放多个 event 数组</span>
<span class="token keyword">const</span> eventsMatrix <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
rrweb<span class="token punctuation">.</span><span class="token function">record</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">emit</span><span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> isCheckout</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// isCheckout 是一个标识，告诉你重新制作了快照</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isCheckout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      eventsMatrix<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> lastEvents <span class="token operator">=</span> eventsMatrix<span class="token punctuation">[</span>eventsMatrix<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    lastEvents<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">checkoutEveryNms</span><span class="token operator">:</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token comment">// 每5分钟重新制作快照</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 向后端传送最新的两个 event 数组</span>
window<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> len <span class="token operator">=</span> eventsMatrix<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token keyword">const</span> events <span class="token operator">=</span> eventsMatrix<span class="token punctuation">[</span>len <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>eventsMatrix<span class="token punctuation">[</span>len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> body <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> events <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://YOUR_BACKEND_API'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    body<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>在上面的例子中，你最终会拿到最新的 5-10 分钟的 event 来发送给你的后端。</p> <h3 id="回放"><a href="#回放" class="header-anchor">#</a> 回放</h3> <p>回放时需要引入对应的 CSS 文件：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span>
  <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.jsdelivr.net/npm/rrweb@latest/dist/rrweb.min.css<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>再通过以下 JS 代码初始化 replayer：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> events <span class="token operator">=</span> <span class="token constant">YOUR_EVENTS</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> replayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">rrweb<span class="token punctuation">.</span>Replayer</span><span class="token punctuation">(</span>events<span class="token punctuation">)</span><span class="token punctuation">;</span>
replayer<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="使用-api-控制回放"><a href="#使用-api-控制回放" class="header-anchor">#</a> 使用 API 控制回放</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> replayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">rrweb<span class="token punctuation">.</span>Replayer</span><span class="token punctuation">(</span>events<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 播放</span>
replayer<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 从第 3 秒的内容开始播放</span>
replayer<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 暂停</span>
replayer<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 暂停至第 5 秒处</span>
replayer<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 销毁播放器 (提示： 这个操作不可逆)</span>
replayer<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="配置参数-2"><a href="#配置参数-2" class="header-anchor">#</a> 配置参数</h4> <p>可以通过 <code>new rrweb.Replayer(events, options)</code> 的方式向 rrweb 传递回放时的配置参数，具体配置如下：</p> <table><thead><tr><th>key</th> <th>默认值</th> <th>功能</th></tr></thead> <tbody><tr><td>speed</td> <td>1</td> <td>回放倍速</td></tr> <tr><td>root</td> <td>document.body</td> <td>回放时使用的 HTML 元素</td></tr> <tr><td>loadTimeout</td> <td>0</td> <td>加载异步样式表的超时时长</td></tr> <tr><td>skipInactive</td> <td>false</td> <td>是否快速跳过无用户操作的阶段</td></tr> <tr><td>showWarning</td> <td>true</td> <td>是否在回放过程中打印警告信息</td></tr> <tr><td>showDebug</td> <td>false</td> <td>是否在回放过程中打印 debug 信息</td></tr> <tr><td>blockClass</td> <td>'rr-block'</td> <td>需要在回放时展示为隐藏区域的元素类名</td></tr> <tr><td>liveMode</td> <td>false</td> <td>是否开启直播模式</td></tr> <tr><td>insertStyleRules</td> <td>[]</td> <td>可以传入多个 CSS rule string，用于自定义回放时 iframe 内的样式</td></tr> <tr><td>triggerFocus</td> <td>true</td> <td>回放时是否回放 focus 交互</td></tr> <tr><td>UNSAFE_replayCanvas</td> <td>false</td> <td>回放时是否回放 canvas 内容，<strong>开启后将会关闭沙盒策略，导致一定风险</strong></td></tr> <tr><td>pauseAnimation</td> <td>true</td> <td>当播放器停止播放时，是否将 CSS 动画也停止播放</td></tr> <tr><td>mouseTail</td> <td>true</td> <td>是否在回放时增加鼠标轨迹。传入 false 可关闭，传入对象可以定制轨迹持续时间、样式等，配置详见<a href="https://github.com/rrweb-io/rrweb/blob/9488deb6d54a5f04350c063d942da5e96ab74075/src/types.ts#L407" target="_blank" rel="noopener noreferrer">类型<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td></tr> <tr><td>unpackFn</td> <td>-</td> <td>数据解压缩函数，详见<a href="/document/solution/录屏/docs/recipes/optimize-storage.zh_CN.html">优化存储策略</a></td></tr> <tr><td>plugins</td> <td>[]</td> <td>加载插件以获得额外的回放功能. <a href="/document/solution/录屏/docs/recipes/plugin.zh_CN.html">什么是插件？</a></td></tr> <tr><td>useVirtualDom</td> <td>true</td> <td>在播放器跳转到一个新的时间点的过程中，是否使用 Virtual Dom 优化</td></tr></tbody></table> <h4 id="使用-rrweb-player"><a href="#使用-rrweb-player" class="header-anchor">#</a> 使用 rrweb-player</h4> <p>rrweb 自带的回放只提供所有的 JS API 以及最基本的 UI，如果需要功能更强的回放播放器 UI，可以使用 rrweb-player。</p> <h5 id="安装-2"><a href="#安装-2" class="header-anchor">#</a> 安装</h5> <p>rrweb-player 同样可以使用 CDN 方式安装：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span>
  <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.jsdelivr.net/npm/rrweb-player@latest/dist/style.css<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://cdn.jsdelivr.net/npm/rrweb-player@latest/dist/index.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>或者通过 npm 安装：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">--save</span> rrweb-player
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> rrwebPlayer <span class="token keyword">from</span> <span class="token string">'rrweb-player'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'rrweb-player/dist/style.css'</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h5> <p>通过 props 传入 events 数据及配置项</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">rrwebPlayer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">target</span><span class="token operator">:</span> document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token comment">// 可以自定义 DOM 元素</span>
  <span class="token comment">// 配置项</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    events<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="配置项参数"><a href="#配置项参数" class="header-anchor">#</a> 配置项参数</h5> <table><thead><tr><th>key</th> <th>默认值</th> <th>功能</th></tr></thead> <tbody><tr><td>events</td> <td>[]</td> <td>包含回放所需的数据</td></tr> <tr><td>width</td> <td>1024</td> <td>播放器宽度</td></tr> <tr><td>height</td> <td>576</td> <td>播放器高度</td></tr> <tr><td>autoPlay</td> <td>true</td> <td>是否自动播放</td></tr> <tr><td>speedOption</td> <td>[1, 2, 4, 8]</td> <td>倍速播放可选值</td></tr> <tr><td>showController</td> <td>true</td> <td>是否显示播放器控制 UI</td></tr> <tr><td>tags</td> <td>{}</td> <td>可以以 key value 的形式展示自定义事件在时间轴上的颜色</td></tr> <tr><td>...</td> <td>-</td> <td>其它所有 rrweb Replayer 的配置参数均可透传</td></tr></tbody></table> <h4 id="事件"><a href="#事件" class="header-anchor">#</a> 事件</h4> <p>开发者可能希望监听回放时的各类事件，例如在跳过无用户操作的时间时给用户一些提示。</p> <p>rrweb 的 Replayer 提供了 <code>on</code> API 用于提供该功能</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> replayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">rrweb<span class="token punctuation">.</span>Replayer</span><span class="token punctuation">(</span>events<span class="token punctuation">)</span><span class="token punctuation">;</span>
replayer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token constant">EVENT_NAME</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>其包含的事件如下：</p> <table><thead><tr><th>事件类型</th> <th>描述</th> <th>值</th></tr></thead> <tbody><tr><td>start</td> <td>回放开始</td> <td>-</td></tr> <tr><td>pause</td> <td>回放暂停</td> <td>-</td></tr> <tr><td>finish</td> <td>回放完成</td> <td>-</td></tr> <tr><td>resize</td> <td>回放视图大小发生变化</td> <td>{ width, height }</td></tr> <tr><td>fullsnapshot-rebuilded</td> <td>全量快照完成重建</td> <td>event</td></tr> <tr><td>load-stylesheet-start</td> <td>开始加载远端样式表</td> <td>-</td></tr> <tr><td>load-stylesheet-end</td> <td>加载远端样式表完成</td> <td>-</td></tr> <tr><td>skip-start</td> <td>开始跳过无用户操作时间</td> <td>{ speed }</td></tr> <tr><td>skip-end</td> <td>结束无用户操作时间</td> <td>{ speed }</td></tr> <tr><td>mouse-interaction</td> <td>回放鼠标交互事件</td> <td>{ type, target }</td></tr> <tr><td>event-cast</td> <td>回放 event</td> <td>event</td></tr> <tr><td>custom-event</td> <td>回放自定义事件</td> <td>event</td></tr> <tr><td>destroy</td> <td>销毁播放器</td> <td>-</td></tr></tbody></table> <p>使用 <code>rrweb-player</code> 时，也可以通过 <code>addEventListener</code> API 使用相同的事件功能，并且会获得 3 个额外的事件：</p> <table><thead><tr><th>事件类型</th> <th>描述</th> <th>值</th></tr></thead> <tbody><tr><td>ui-update-current-time</td> <td>当前回放时间点</td> <td>{ payload }</td></tr> <tr><td>ui-update-player-state</td> <td>当前回放状态</td> <td>{ payload }</td></tr> <tr><td>ui-update-progress</td> <td>当前回放百分比</td> <td>{ payload }</td></tr></tbody></table> <h2 id="repl-工具"><a href="#repl-工具" class="header-anchor">#</a> REPL 工具</h2> <p>在不安装 rrweb 的情况下，也可以通过使用 REPL 工具试用 rrweb 录制 web 应用。</p> <p>运行 <code>yarn repl</code>，将会启动浏览器并在命令行要求输入一个测试的 url：</p> <div class="language- extra-class"><pre class="language-text"><code>Enter the url you want to record, e.g https://react-redux.realworld.io:
</code></pre></div><p>输入后等待浏览器打开指定页面，并在命令行中出现以下提示信息：</p> <div class="language- extra-class"><pre class="language-text"><code>Enter the url you want to record, e.g https://react-redux.realworld.io: https://github.com
Going to open https://github.com...
Ready to record. You can do any interaction on the page.
Once you want to finish the recording, enter 'y' to start replay:
</code></pre></div><p>此时可以在页面中进行交互，待所需录制操作完成后，在命令行输入 y，测试工具就会将刚刚的操作进行回放，用于验证录制是否成功。</p> <p>回放时命令行中将出现以下提示信息：</p> <div class="language- extra-class"><pre class="language-text"><code>Enter 'y' to persistently store these recorded events:
</code></pre></div><p>此时可以再次在命令行中输入 y，测试工具将把已录制的内容存入一个静态 HTML 文件中，并提示存放位置：</p> <div class="language- extra-class"><pre class="language-text"><code>Saved at PATH_TO_YOUR_REPO/temp/replay_2018_11_23T07_53_30.html
</code></pre></div><p>该文件默认使用最新 bundle 的 rrweb 代码，所以我们可以在修改代码后运行 <code>npm run bundle:browser</code>，之后刷新静态文件就可以查看最新代码对回放的影响并进行调试。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/document/solution/录屏/录屏.html" class="prev">
        录屏
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2be4d4d0.js" defer></script><script src="/assets/js/3.ea86773f.js" defer></script><script src="/assets/js/46.c3c4ea4d.js" defer></script>
  </body>
</html>
